name: Update README

on:
  schedule:
    # Runs every 24 hours
    - cron: '0 0 * * *'

  workflow_dispatch:

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Fetch GitHub repositories and update README
        run: |
          curl -H "Authorization: token ${{ secrets.GH_TOKEN }}" https://api.github.com/user/repos?per_page=100 \
          | jq '.[] | "* [\(.name)](\(.html_url)) - \(.description // "No description provided." )"' > repos.md
          
          # Update README.md with the repo information
          sed -i '/<!-- REPO LIST START -->/,/<!-- REPO LIST END -->/c\<!-- REPO LIST START -->\n'$(cat repos.md)'\n<!-- REPO LIST END -->' README.md

      - name: Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update README with repository info"
          git push
